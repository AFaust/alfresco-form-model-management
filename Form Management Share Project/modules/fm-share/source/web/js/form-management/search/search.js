function updateURL(b,e,h){var k="";var g=b.split("?");var c=g[0];var d=g[1];var j="";if(d){var g=d.split("&");for(i=0;i<g.length;i++){if(g[i].split("=")[0]!=e){k+=j+g[i];j="&"}}}var a=j+""+e+"="+h;var f=c+"?"+k+a;return f}function bytesToSize(a){var c=["Bytes","KB","MB","GB","TB"];if(a==0){return"n/a"}var b=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,b),2)+" "+c[b]}function docDetailTemplate(d){var c="";if(d.path==""){d.path="%2F"+encodeURIComponent(d.name)}var b="/share/page/repository?path="+d.path;var a="",e="";if(d.site){e="/share/page/site/"+d.site.shortName+"/";b=e+"documentlibrary?path="+encodeURIComponent(d.path);a='Site: <a href="/share/page/site/'+d.site.shortName+'/dashboard">'+d.site.title+"</a>,"}c='<div class="doc-search-details">';c+="	<h3>";if(d.type!="folder"){c+='		<a class="theme-color-1 ua-res-doc-title" href="'+e+"document-details?nodeRef="+d.nodeRef+'">'+d.name+" </a>"}else{c+='		<a class="theme-color-1 ua-res-doc-title" href="'+b+"%2F"+d.name+'">'+d.name+" </a>"}if(d.title&&d.title!=""){c+='		<span class="title">('+d.title+")</span>"}c+="	</h3>";c+='	<div class="ua-res-detail"> ';c+='	<span class="item"><em>Modified on:</em>'+d.modifiedOn+' by <a href="/share/page/user/'+d.modifiedByUser+'/profile">'+d.modifiedBy+"</a></span>";c+='	<div class="detail-view">';if(d.type!="folder"){c+="<span>"+a+" size: "+bytesToSize(d.size)+"</span>"}c+='<span>In Folder: <a href="'+b+'">'+d.path+"</a></span> </div> </div> </div>";return c}function ImgError(a){a.src="/share/res/components/images/filetypes/generic-file-32.png";a.onerror="";return true}function rowTemplate(c){var b=c.name.substr((c.name.lastIndexOf(".")+1))+"-file";b=b.toLowerCase();if(c.type=="folder"){b="generic-folder"}var a="";c.loccontext="repo";var d="";if(c.site){d="/share/page/site/"+c.site.shortName+"/";c.loccontext="site"}a+='<div class="'+c.loccontext+' ua-res-doc">';a+='<table style="width:100%" class="detail-list">';a+="	<tr>";a+='		<td style="  padding-left: 10px;  vertical-align: baseline; width: 35px;">';a+='			<span class="ico-'+c.loccontext+'">&nbsp;</span> ';if(c.hasAssociations){a+='<img style="left: 19px; position: relative; top: -13px;" src="/share/res/components/documentlibrary/indicators/paper-clip-16.png" alt="Document has associations" title="Has associations" />'}a+="		</td>";a+='		<td class="doc-search-details">';a+='			<div class="doc-search-icon">';a+='				<a href="#" class="simple-view" style="display:none;"><img title="'+c.name+'" alt=".'+b+'" src="/share/res/components/images/filetypes/'+b+'-32.png" id="yui-gen111" onerror="ImgError(this);"></a>';if(c.type=="folder"){a+='			<a href="#" style="display: block; height: 90px;" class="detail-view" id="yui-gen126"><img title="folder" alt="folder" src="/share/res/components/search/images/folder.png" id="yui-gen125"></a>'}else{a+='			<a target="_blank" class="detail-view" href="/share/proxy/alfresco/api/node/content/workspace/SpacesStore//'+c.id+"/"+c.name+'?a=true"><img src="/share/proxy/alfresco/api/node/workspace/SpacesStore/'+c.id+'/content/thumbnails/doclib?ph=true&c=queue" /></a>'}a+="			</div>";a+=docDetailTemplate(c);a+='			<p class="clear"></p>';a+="		</td>";a+='		<td style="width: 170px;">';a+='			<div class="resultTools">';a+="				<ul>";a+='					<li><a href="'+d+"document-details?nodeRef="+c.nodeRef+'" class="ico-view">View Metadata</a></li>';if(c.type=="document"){if(c.hasWriteAccess){a+='<li><a href="'+c.id+'" class="ico-move-dropbox">Move to Dropbox</a></li>'}}a+='					<li><a target="_blank" href="/share/proxy/alfresco/api/node/content/workspace/SpacesStore//'+c.id+"/"+c.name+'?a=true" class="ico-download">Download</a></li>';a+="				</ul>";a+="			</div>";a+="		</td>";a+="	</tr>";a+="</table>";a+="</div>";return a}function injectAlfrescoDefaults(){var a=$(".injectionForm").html();$(".injectionForm").html("");$(".f_b_root:eq(0)").prepend(a);$(".modDatePicker").mask("9999-99-99").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true});var c=getQueryObject();var b=decodeURIComponent(getURLParameter("t"));if(advsearchAspects.length>0){$(".fm-profile").form("loadPropertiesToFields",c)}if(b!=""){$('.search-field, input[name = "t"]').removeClass("default").val(b)}}function getQueryPath(){var b="r=false";var a=$(".fm-search-type").val();if(a=="all-sites"){b="a=true"}if(a=="repo"){b="r=true"}return b}function getQueryObject(){var nodeObj={};nodeObj.node={};nodeObj.node.properties={};if(getURLParameter("q")!=""){var queryString=decodeURIComponent(getURLParameter("q").replace(/prop_/g,"").replace(/_/g,":"));var queryMap=eval("("+queryString+")");var nodeObj={};nodeObj.node={};nodeObj.node.properties=queryMap}return nodeObj}function collectQuery(){var a="";var e={};var c="";$("#formFormat .group .frm-fld").each(function(){var h=$(this);var m=false;var o="";var p="prop_"+h.attr("name");if(h.data("type")){o=h.data("type")}if(h.attr("name")=="cm_modified_from"||h.attr("name")=="cm_modified_to"){var l=$("input[name='cm_modified_from']").val();var g=$("input[name='cm_modified_to']").val();if(l!=""||g!=""){e["prop_cm_modified-date-range"]=l+"|"+g}m=false}else{if(h.val()!=""){m=true}}if(h.attr("id")){if(h.attr("id").indexOf("bool-")>=0){h=h.parents(".group").find(".isBoolHidden")}}if(h.attr("type")=="radio"){if(h.is(":checked")){var n=h.attr("name");var k=h.val();e[p]=encodeURIComponent($("input[name='"+n+"']:checked").val())}}else{if(o.indexOf("boolean")>0){if(h.is(":checked")){e[p]=true}}else{if(h.attr("name").indexOf("_toDate")>0){}else{if(h.attr("name")=="t"){if(h.val()!=""){c="t="+h.val()+"&"}}else{if(h.hasClass("date")){if(h.val()!=""){var f=$("input[name='"+h.attr("name")+"_toDate']").val();var q=h.val();if(f){var j=f;e[p+"-date-range"]=(q)+"|"+(j)}else{e[p]=h.val()}}}else{if(m&&h.val()!="false"){if(h.attr("name")==FM.documentType){if($(".docInSearch").attr("checked")){e[p]=encodeURIComponent(h.val())}}else{e[p]=encodeURIComponent(h.val())}}}}}}}});e.datatype="cm:content";var b=JSON.stringify(e);var d=c+"q="+(b);return d}function moveDocument(a,b,d,c){if(!c){c=""}$(".infoMessage span").html("Please wait...");$(".infoMessage").removeClass("good").center();$(".infoMessage").fadeIn(300).center();jQuery.ajax({type:"GET",url:"/share/proxy/alfresco/uofa/form-management/formdata/move",dataType:"json",data:{nodes:a,destination:c,aspect:b,siteid:$(".fm-site-id").val(),isRecord:d},success:function(e){if(e.status==0){$(".infoMessage").addClass("warning");$(".infoMessage span").html(e.msg+" "+e.validation.service.msg);$(".infoMessage").center();setTimeout('$(".infoMessage").fadeOut(300, function(){  $(".infoMessage").removeClass("warning"); }); ',4000)}else{$(".infoMessage span").html(""+e.successMove+" item(s) moved successfully. "+e.failedMove+" item(s) failed.");$(".infoMessage").removeClass("good").center();setTimeout('$(".infoMessage").fadeOut(300, function(){ location.reload(true) }); ',3000)}},error:function(g,e,f){$(".infoMessage").addClass("warning");$(".infoMessage span").html("Sorry, you do not have the right permission to do that. Please contact your administrator if you require access.");$(".infoMessage").center();setTimeout('$(".infoMessage").fadeOut(300, function(){  $(".infoMessage").removeClass("warning"); }); ',4000)}})}function toggleSearchView(a){$(".detail-view, .sym-search-grid, .simple-view, .grid-option").hide();$(".sym-search-body, .search-sort").show();$(".btn-jq-active").removeClass("btn-jq-active");$(".btn-"+a+"-view").addClass("btn-jq-active");switch(a){case"simple":$(".simple-view").show();$(".doc-search-icon").css({"padding-right":"5px",width:"auto"});break;case"detail":$(".detail-view").show();$(".doc-search-icon").css({"padding-right":"20px",width:"80px"});break;case"grid":$(".sym-search-grid, .grid-option").show();$(".sym-search-body, .search-sort").hide();$(".btn-grid-view").addClass("btn-jq-active");loadDatatable();break}}function setupFilterField(){var a=".doc-search-details";$(".filter-field").change(function(){var b=$(this).val();if(b!=""&&b.replace(/ /g,"").length>0){$(a).find("h3:not(:Contains("+b+"))").parents(".ua-res-doc").slideUp();$(a).find("h3:Contains("+b+")").parents(".ua-res-doc").slideDown()}else{$(".ua-res-doc").slideDown()}return false}).keyup(function(){$(this).change()})}function getURLParameter(a){var b=decodeURI((RegExp(a+"=(.+?)(&|$)").exec(location.search)||[,null])[1]);if(b=="null"){b=""}return b}function getQueryForSearch(){var a={};if(getURLParameter("a")=="true"){}else{a.site=$(".fm-site-id").val().slice(0,-5)}a.term=decodeURIComponent(getURLParameter("t"));a.tag=getURLParameter("tag");a.maxResults=500;a.sort=getURLParameter("s");a.query=getURLParameter("q");a.repo=getURLParameter("r");return a}function search(){$(".sym-search-body .info").hide();$(".infoMessage span").html("Searching, please wait...");$(".infoMessage").removeClass("good").center();$(".infoMessage").fadeIn(300).center();var a=getQueryForSearch();$.ajax({type:"GET",url:"/share/proxy/alfresco/slingshot/search",dataType:"json",data:a,success:function(d){var c="";if(d.items.length>=500){c="+"}$(".search-sort span:eq(0)").html(d.items.length+c);for(i in d.items){var e=d.items[i];e.id=e.nodeRef.replace("workspace://SpacesStore/","");var b=rowTemplate(e);$(".sym-search-body").append(b)}$(".infoMessage").fadeOut(300,function(){})},error:function(d,b,c){$(".infoMessage").addClass("warning");$(".infoMessage span").html("There was an issue with the search service. Contact your administrator.");$(".infoMessage").center();setTimeout('$(".infoMessage").fadeOut(300, function(){  $(".infoMessage").removeClass("warning"); }); ',4000)}})}function setupYUISortMenu(a){if(a!=""){$("#sortmenuselect").val(a);var d=$("#sortmenuselect option:selected").text()}var c=new YAHOO.widget.Button("sortmenu",{type:"menu",menu:"sortmenuselect"});c.addClass("sort-button");if(a!=""){c.set("label","sorted by: "+d)}var b=function(g,f){var e=f[0],j=f[1];if(j){var h="sorted by: "+j.cfg.getProperty("text");c.set("label",h);window.location.href=updateURL(window.location.href,"s",j.value)}};c.getMenu().subscribe("click",b)}$(function(){if(getURLParameter("t")!=""||getURLParameter("q")!=""){search()}setupYUISortMenu(getURLParameter("s"));$("a.simple-view").live("mouseover",function(){$(this).parent().find(".detail-view").addClass("preview-jump-out")}).live("mouseout",function(){$(this).parent().find(".detail-view").removeClass("preview-jump-out")});$(".btn-simple-view").click(function(){toggleSearchView("simple")});$(".btn-detail-view").click(function(){toggleSearchView("detail")});$(".btn-grid-view").click(function(){toggleSearchView("grid")});$(".search-type .ibg a").click(function(){$(".search-type ul").toggle()});$(".search-type ul").mouseleave(function(){setTimeout("$('.search-type ul').hide();",500)});$(".search-type > ul > li > a").click(function(){var g=$(this).attr("class");var d="false";var b="false";var e="";if(g=="ico-repo"){d="true"}if(g=="ico-all-sites"){b="true"}var f=["t","s","q","tag","a","r"];for(i in f){var c=getURLParameter(f[i]);if(f[i]=="r"){c=d}if(f[i]=="a"){c=b}if(c!=""){e+=f[i]+"="+c+"&"}}window.location="?"+e});$(".fileSelect").live("click",function(){var a=$(".fileSelect:checked").length;if(a>0){$(".recdocflip .ua-menu").removeClass("ua-disabled")}else{$(".recdocflip .ua-menu").addClass("ua-disabled")}});$(".ac-mvrecords").click(function(){var a="";$(".fileSelect:checked").each(function(){if(!$(this).parents(".ua-res-doc").hasClass("record")){a+=$(this).attr("id")+"~"}});a=a.slice(0,-1);if(a!=""){moveDocument(a,nodeValFormAspect,true)}return false});$(".ac-mvdropbox").click(function(){var a="";$(".fileSelect:checked").each(function(){if(!$(this).parents(".ua-res-doc").hasClass("record")){a+=$(this).attr("id")+"~"}});a=a.slice(0,-1);if(a!=""){moveDocument(a,"",false,$(".fm-dropbox-nodeRef").val().replace("workspace://SpacesStore/",""))}return false});$(".ico-move").live("click",function(){var a=confirm("Are you sure you want to move this item to Records?");if(a){moveDocument($(this).attr("href"),nodeValFormAspect,true)}return false});$(".ico-move-dropbox").live("click",function(){var a=confirm("Are you sure you want to move this item to your Dropbox?");if(a){moveDocument($(this).attr("href"),"",false,$(".fm-dropbox-nodeRef").val().replace("workspace://SpacesStore/",""))}return false});$(".switch").click(function(){$(".switch-selected").removeClass("switch-selected");if($(this).hasClass("show-records")){$(".document").hide();$(".record").show();$(this).addClass("switch-selected")}if($(this).hasClass("show-document")){$(".record").hide();$(".document").show();$(this).addClass("switch-selected")}if($(this).hasClass("show-all")){$(".document, .record").show();$(this).addClass("switch-selected")}});$("#configTabs").tabs({selected:0});$(".default").each(function(){$(this).val($(this).attr("title"))});$(".sym-header input, .search-filter input").focus(function(){if($(this).hasClass("default")){$(this).removeClass("default");$(this).val("")}}).blur(function(){if($(this).val()==""){$(this).addClass("default");$(this).val($(this).attr("title"))}});$(".lsb").mouseup(function(){var a=$("#searchindex").val();var b=getQueryPath();window.location="?"+b+"&"+a.replace(/#VALUE#/g,encodeURIComponent($(".search-field").val()))});$(".search-field").live("keydown",function(c){if(c.which==13){var a=$("#searchindex").val();var b=getQueryPath();window.location="?"+b+"&"+a.replace(/#VALUE#/g,encodeURIComponent($(".search-field").val()))}});$(".dynamic-criteria").dialog({autoOpen:false,width:585,resizable:false,modal:false,draggable:false,position:["center",15],buttons:{Cancel:function(){$(this).dialog("close")},Search:function(){var a=collectQuery();var b=getQueryPath();window.location="?"+b+"&"+a}},open:function(){$(this).find(".ui-dialog-titlebar-close").blur();$(this).addClass("ui-dialog-tabs")}}).parent().find(".ui-dialog-titlebar-close").prependTo("#configTabs").closest(".ui-dialog").children(".ui-dialog-titlebar").remove();$(".dynamic-criteria").parent().draggable({handle:".ui-tabs-nav"});$(".advanced-search-button").click(function(){$(".dynamic-criteria").dialog("open");$(".pageCountCheck ").select().focus()});$(".ua-menu").mouseenter(function(){if(!$(this).hasClass("ua-disabled")){$(this).addClass("ua-dropdown-hover-state")}}).mouseleave(function(){$(this).removeClass("ua-dropdown-hover-state")});$(".ua-menu").mousedown(function(){if(!$(this).hasClass("ua-disabled")){$(this).find("ul").fadeIn(100).addClass("open-state")}});$(".ua-menu ul").mouseleave(function(){submenuTimer=setTimeout("$('.open-state').hide(); $('.open-state').removeClass('open-state'); ",200)});$(".ua-menu li ul").mouseenter(function(){clearTimeout(submenuTimer)});$(".ua-res-doc").live("mouseover",function(){$(this).addClass("ua-res-row-highlight");$(this).find(".resultTools").show()}).live("mouseout",function(){$(this).removeClass("ua-res-row-highlight");$(this).find(".resultTools").hide()});jQuery.expr[":"].Contains=function(c,d,b){return(c.textContent||c.innerText||"").toUpperCase().indexOf(b[3].toUpperCase())>=0};setupFilterField()});jQuery.fn.center=function(){this.css("position","absolute");this.css("top",200);this.css("left",(($(window).width()-this.outerWidth())/2)+$(window).scrollLeft()+"px");return this};