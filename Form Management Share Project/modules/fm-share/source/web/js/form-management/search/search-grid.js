if(!FM){var FM={};FM.prefix="ua";FM.documentType=FM.prefix+"_documenttype";}var documentTypeGrid="prop_"+FM.documentType;var gridEnabled=true;var oSearchGrid=null;function getGridEnabled(aspects){var obj={};obj.fields=[];obj.headers=[];for(i in aspects){var a=aspects[i];for(z in a.properties){var f=a.properties[z];if(f.searchGrid){obj.fields.push(a.namespace+":"+f.name);obj.headers.push(f.title);}}}return obj;}function setSearchTableHeaders(aspects){var query=getURLParameter("q");var obj={};obj.fields=[];if(gridEnabled&&query.length>0&&documentTypeGrid){var q=eval("("+query+")");if(q[documentTypeGrid]!=""){$(".btn-grid-view").show();obj=getGridEnabled(aspects);$("#dropbox thead tr").append('<th class="dt-check-column"><input type="checkbox" class="dtRowSelectAll" /></th><th>Filename</th>');for(i in obj.headers){$("#dropbox thead tr").append("<th>"+obj.headers[i]+"</th>");}$("#dropbox thead tr").append("<th>Actions</th>");}}return obj.fields;}function loadDatatable(){if(!oSearchGrid){var url="/share/proxy/alfresco/slingshot/search";oSearchGrid=$("#dropbox").dataTable({"bProcessing":true,"sAjaxSource":url,"sPaginationType":"full_numbers","oLanguage":{"sSearch":""},"aaSorting":[],"fnServerData":function(sSource,aoData,fnCallback){aoData=getQueryForSearch();aoData.fields=dtFields.join(",");$.ajax({"dataType":"json","url":sSource,"data":aoData,"success":fnCallback});},"aoColumnDefs":[{bSortable:false,aTargets:[0],fnRender:function(o,v){return'<input type="checkbox" class="dtRowSelect" />';}}],"aLengthMenu":[[10,25,50,100,200,255],[10,25,50,100,200,255]],"iDisplayLength":255});}}function printSelected(){$("body").append('<div id="printme"><table style="font-family:helvetica; font-size:12px; width:100%">'+$("table#dropbox").html()+"</table></div>");$("#printme table tbody").html("");$("#printme table th").attr("style","");$(".dtRowSelect:checked").each(function(){$(this).parents("tr").clone().appendTo("#printme table tbody");});var q=getQueryObject();if(q.node.properties){var dr=q.node.properties[FM.prefix+":datereceived-date-range"];if(dr){var dateR=dr.split("|");var from=dateR[0].substring(0,10);var to="";if(dateR[1]){to=" - "+dateR[1].substring(0,10);}$("#printme").prepend('<div style="font-family:helvetica; font-size:12px; margin-bottom:20px;">Date Received Searched: '+from+to+"</div>");}}$("#printme table tbody tr").each(function(){$(this).find("td:eq(0)").remove();$(this).find("td:last").remove();});$("#printme table thead tr").each(function(){$(this).find("th:eq(0)").remove();$(this).find("th:last").remove();});$("#printme").printThis({loadCSS:"/share/css/form-management/search/print-search-grid.css",pageTitle:"Alfresco search print results"});$("#printme").remove();}var oSelectMenuButton=null;function toggleSelectMenu(){oSelectMenuButton.set("disabled",true);if($(".dtRowSelect:checked").length>0){oSelectMenuButton.set("disabled",false);}}function setupSelectMenu(){$(".dtRowSelect").live("click",function(){toggleSelectMenu();});$(".dtRowSelectAll").live("click",function(){$(".dtRowSelect").attr("checked",false);if($(".dtRowSelectAll:checked").length>0){$(".dtRowSelect").attr("checked",true);}toggleSelectMenu();});oSelectMenuButton=new YAHOO.widget.Button("selectmenu",{type:"menu",menu:"selectmenuselect"});oSelectMenuButton.addClass("sort-button");oSelectMenuButton.set("disabled",true);var onSelectMenuClick=function(p_sType,p_aArgs){var oEvent=p_aArgs[0],oMenuItem=p_aArgs[1];if(oMenuItem){switch(oMenuItem.value){case"print":printSelected();break;case"downloadZip":var nodes=[];$(".dtRowSelect:checked").each(function(){var id=$(this).parents("tr:eq(0)").find("td:eq(1) > a").attr("href").split("/").reverse()[0];nodes.push(id);});var url="/share/proxy/alfresco/slingshot/zipContents?nodes="+nodes.join(",")+"&filename=TranscriptsDownload&noaccent=false";window.location.assign(url);break;case"downloadCSV":exportTableToCSV($(".dtRowSelect:checked, .dt-check-column"),"Advanced Search Results Report.csv");break;}}};oSelectMenuButton.getMenu().subscribe("click",onSelectMenuClick);}IELessThan=function(version){var browserNotSupported=(function(){var div=document.createElement("DIV");div.innerHTML="<!--[if lte IE "+version+"]><I></I><![endif]-->";return div.getElementsByTagName("I").length>0;}());return browserNotSupported;};function exportTableToCSV($rows,filename){tmpColDelim=String.fromCharCode(11);tmpRowDelim=String.fromCharCode(0);colDelim='","';rowDelim='"\r\n"';csv='"'+$rows.map(function(i,row){var $row=$(row).parents("tr:eq(0)");var $cols=$row.find("td,th");return $cols.map(function(j,col){var $col=$(col),text=$col.text();if(j==0||text=="Download"||text=="Actions"){return null;}else{return text.replace('"','""');}}).get().join(tmpColDelim);}).get().join(tmpRowDelim).split(tmpRowDelim).join(rowDelim).split(tmpColDelim).join(colDelim)+'"';var oldIE;if(IELessThan(10)){oldIE=true;}if(oldIE){csvData=encodeURIComponent(csv);$.ajax({"dataType":"json","url":"/share/service/components/form-management/ajax/csvdata/save","type":"POST","data":{"mypost":csvData},"success":function(data,textStatus,jqXHR){window.location.href="/share/proxy/alfresco/api/node/content/workspace/SpacesStore/"+data.nodeRef.split("/").reverse()[0]+"?a=true";},"error":function(jqXHR,textStatus,errorThrown){alert("error getting CSV"+jqXHR+" "+textStatus+" "+errorThrown);}});}else{var blob=new Blob([csv],{type:"text/csv;charset=utf-8"});saveAs(blob,"Advanced Search Results Report.csv");}}$(function(){var csrf_token=Alfresco.util.CSRFPolicy.getToken();if(csrf_token){$("body").bind("ajaxSend",function(elm,xhr,s){if(s.type=="POST"){xhr.setRequestHeader("Alfresco-CSRFToken",csrf_token);}});}setupSelectMenu();});